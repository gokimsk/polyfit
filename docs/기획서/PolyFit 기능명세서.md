# 📄 PolyFit 기능명세서

**버전**: v1.0

**작성일**: 2025.08.02

**목적**: 개발 시 구체적인 동작 로직 및 상호작용 규칙 정의

---

## F1. 상황카드 선택 기능

### 기본 동작

- **선택 가능 개수**: 최대 3개
- **4번째 클릭 시**: 클릭 불가 (비활성화 상태)
- **선택 상태 표시**: 테두리 강조 + 체크 아이콘
- **선택 해제**: 선택된 카드 재클릭 시 해제
- **미선택 카드 상태**: 3개 선택 완료 시 나머지 카드 비활성화 (회색 처리)

### 버튼 텍스트 변화

```
0개 선택: "상황을 선택해주세요" (비활성화)
1개 선택: "1개 상황으로 정책 찾기"
2개 선택: "2개 상황으로 정책 찾기"
3개 선택: "3개 상황으로 정책 찾기"

```

### URL 생성 규칙

```
/policies?situations=independence,job-seeking,marriage-prep

```

---

## F2. 태그 매칭 알고리즘

### 점수 계산 로직

```jsx
function calculateMatchScore(selectedSituations, policy) {
  let score = 0;

  // 1순위: 태그 매칭 개수 (기본 점수)
  const userTags = selectedSituations.flatMap(s => s.tags);
  const matchingTags = policy.tags.filter(tag => userTags.includes(tag));
  score += matchingTags.length;

  // 2순위: 상황 매칭 개수
  const matchingSituations = policy.situations.filter(s =>
    selectedSituations.map(sit => sit.id).includes(s)
  );
  score += matchingSituations.length;

  // 3순위: 마감 임박 보너스 (+1점)
  const deadline = new Date(policy.deadline);
  const daysLeft = (deadline - new Date()) / (1000 * 60 * 60 * 24);
  if (daysLeft <= 30 && daysLeft > 0) score += 1;

  return score;
}

```

### 정렬 우선순위 (동점 시)

1. **매칭 점수** (내림차순)
2. **마감일** (오름차순)
3. **업데이트일** (내림차순)

---

## F3. 정책 리스트 필터링

### 정렬 옵션 동작

- **추천순**: 매칭 점수 기반 정렬 (기본값)
- **마감임박순**: deadline 필드 기준 오름차순
- **최신순**: updatedAt 필드 기준 내림차순

### 카테고리 필터 동작

- **단일 선택**: 한 번에 하나의 카테고리만 적용
- **전체 보기**: 카테고리 필터 해제 시 모든 정책 표시
- **빈 결과**: 해당 카테고리에 정책이 없을 경우 "정책이 없습니다" 메시지

### URL 파라미터 관리

```
/policies?situations=independence&category=housing&sort=deadline

```

---

## F4. 북마크 기능 (α기능)

### localStorage 저장 규칙

```jsx
// 저장 키: 'polyfit_bookmarks'
// 저장 형태: ["policy-001", "policy-002", "policy-003"]

```

### 동작 로직

- **북마크 추가**: 하트 아이콘 클릭 → 배열에 정책 ID 추가
- **북마크 제거**: 북마크된 정책의 하트 아이콘 재클릭 → 배열에서 제거
- **상태 표시**: 북마크된 정책은 채워진 하트, 아닌 정책은 빈 하트
- **최대 제한**: 없음 (메모리 한계까지)

### 북마크 페이지 (/bookmarks)

- **빈 상태**: "아직 북마크한 정책이 없습니다" + 메인으로 이동 버튼
- **정책 표시**: 북마크 순서대로 표시 (최신 북마크가 위로)
- **북마크 해제**: 리스트에서 직접 해제 가능

---

## α 기능 개요 (시간 여유 시 구현)

### 활용 팁 기능

- **데이터 소스**: `tips.json` 정적 파일
- **표시 위치**: 정책 상세 페이지 내 전용 섹션
- **표시 형태**: "💡 소득 인정액 기준 미리 확인하세요" 스타일

### 이용 현황 기능

- **데이터 소스**: `usage.json` 정적 파일
- **표시 위치**: 정책 상세 페이지 내 전용 섹션
- **표시 형태**: "👥 이런 분들이 많이 찾아요: 자취+구직" 스타일

### 간단한 후기 기능

- **데이터 소스**: `reviews.json` 정적 파일 (샘플 데이터)
- **표시 위치**: 정책 상세 페이지 하단
- **표시 형태**: 별점 + 간단 코멘트 (실명 첫 글자만)

> 참고: α 기능들은 모두 정적 데이터 기반이므로 별도 상세 명세 없이 구현 시점에 데이터 구조만 정의하면 됨
> 

---

## F5. 외부 링크 이동 확인

### 팝업 트리거

- **"신청하기" 버튼 클릭 시**: 확인 팝업 표시
- **정책카드의 외부 링크 클릭 시**: 확인 팝업 표시

### 팝업 내용

```
제목: "외부 사이트로 이동"
내용: "정책 신청을 위해 외부 사이트로 이동합니다. 신청 완료 후 진행상황을 추적할 수 있습니다."
버튼: "취소" / "이동하기"

```

### 동작 로직

- **"이동하기" 클릭**: 새 탭에서 외부 사이트 열기 (`target="_blank"`)
- **"취소" 클릭**: 팝업 닫기, 현재 페이지 유지
- **신청현황 기록**: α 기능으로 구현 시 localStorage에 기록

---

## UI/UX 상호작용 규칙

### 반응형 브레이크포인트

```css
/* 모바일 */
@media (max-width: 767px) {
  상황카드: 2x3 그리드
  정책카드: 단일 컬럼
}

/* 태블릿 */
@media (768px <= width <= 1023px) {
  상황카드: 2x3 그리드 (여백 증가)
  정책카드: 2컬럼 또는 크기 확대
}

/* 데스크탑 */
@media (min-width: 1024px) {
  상황카드: 3x2 그리드
  정책카드: 2-3컬럼 또는 큰 카드
}

```

### 로딩 상태

- **정책 매칭 중**: "맞춤 정책을 찾고 있어요..." 스피너 표시
- **데이터 로딩 중**: 스켈레톤 UI 또는 로딩 스피너
- **최대 로딩 시간**: 3초 (이후 에러 메시지)

### 에러 처리

- **매칭 결과 없음**: "선택한 상황에 맞는 정책이 없습니다" + 다른 상황 선택 유도
- **데이터 로딩 실패**: "데이터를 불러오는 중 오류가 발생했습니다" + 새로고침 버튼
- **외부 링크 오류**: "링크가 유효하지 않습니다" 알림

---

## 데이터 관리 규칙

### localStorage 구조

```jsx
// MVP 범위
{
  "polyfit_bookmarks": ["policy-001", "policy-002"]
}

// α 기능 추가 시
{
  "polyfit_bookmarks": ["policy-001", "policy-002"],
  "polyfit_applications": [
    {
      "policyId": "policy-001",
      "appliedAt": "2025-08-02T10:30:00Z"
    }
  ]
}

```

### URL 파라미터 검증

- **situations**: 존재하는 상황 ID만 허용, 잘못된 ID는 무시
- **category**: 정의된 카테고리만 허용, 잘못된 값은 기본값 적용
- **sort**: 정의된 정렬 옵션만 허용, 잘못된 값은 추천순 적용

### 매칭 점수 범위

- **최소 점수**: 0점 (태그 매칭 없음)
- **최대 점수**: 이론적 최대 = 태그수 + 상황수 + 마감임박보너스
- **표시 방식**: 백분율로 변환하여 "95% 일치" 형태로 표시

---

## 성능 최적화 규칙

### 정책 데이터 관리

- **최대 정책 수**: 30개 (MVP 범위)
- **이미지 사용**: 없음 (텍스트 기반으로 빠른 로딩)
- **데이터 캐싱**: JSON 파일 정적 로딩

### 컴포넌트 최적화

- **상황카드**: 6개 고정, React.memo 적용
- **정책카드**: 가상화 없이 일반 렌더링 (30개 이하)
- **필터링**: 클라이언트 사이드 필터링

---

## 접근성 고려사항

### 키보드 내비게이션

- **Tab 순서**: 상황카드 → 정책 찾기 버튼 → 필터 → 정책카드
- **Enter/Space**: 상황카드 선택/해제
- **Escape**: 팝업 닫기

### 스크린 리더 지원

- **상황카드**: `aria-label="자취 시작 상황 선택"`
- **선택 상태**: `aria-selected="true"`
- **매칭 점수**: `aria-label="95% 매칭, 높은 적합도"`

### 색상 및 대비

- **최소 대비비**: 4.5:1 (WCAG AA 기준)
- **색각 이상 고려**: 색상 외 아이콘으로도 상태 구분
- **포커스 표시**: 명확한 포커스 링 제공